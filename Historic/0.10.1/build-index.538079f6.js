"use strict";function GfxGlueCode(t,e){this.graphicsFound=!1,this.gfxCallback=null,this.doSmoothing=!1,this.offscreenWidth=t,this.offscreenHeight=e,this.offscreenRGBCount=this.offscreenWidth*this.offscreenHeight*3,this.offscreenRGBACount=this.offscreenWidth*this.offscreenHeight*4,this.initializeVSync(),this.initializeBuffers()}GfxGlueCode.prototype.initializeVSync=function(){window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;var t=this;window.requestAnimationFrame?window.requestAnimationFrame((function(){t.vsync(),t.rAFKeepAlive()})):setInterval((function(){t.vsync()}),16)},GfxGlueCode.prototype.rAFKeepAlive=function(){var t=this;window.requestAnimationFrame((function(){t.vsync(),t.rAFKeepAlive()}))},GfxGlueCode.prototype.attachCanvas=function(t){this.canvas=t,this.graphicsFound=this.initializeCanvasTarget()},GfxGlueCode.prototype.detachCanvas=function(){this.canvas=null},GfxGlueCode.prototype.attachGfxCallback=function(t){"function"==typeof t&&(this.gfxCallback=t)},GfxGlueCode.prototype.attachGfxPostCallback=function(t){"function"==typeof t&&(this.gfxPostCallback=t)},GfxGlueCode.prototype.vsync=function(){this.graphicsFound&&("function"==typeof this.gfxCallback&&this.gfxCallback(),this.requestDraw())},GfxGlueCode.prototype.initializeBuffers=function(){this.swizzledFrameFree=[getUint8Array(this.offscreenRGBCount),getUint8Array(this.offscreenRGBCount)],this.swizzledFrameReady=[]},GfxGlueCode.prototype.recomputeDimension=function(){this.canvasLastWidth=this.canvas.clientWidth,this.canvasLastHeight=this.canvas.clientHeight,-1!=navigator.userAgent.toLowerCase().indexOf("gecko")&&-1==navigator.userAgent.toLowerCase().indexOf("like gecko")?(this.onscreenWidth=this.canvas.width=this.offscreenWidth,this.onscreenHeight=this.canvas.height=this.offscreenHeight):(this.onscreenWidth=this.canvas.width=this.canvas.clientWidth,this.onscreenHeight=this.canvas.height=this.canvas.clientHeight)},GfxGlueCode.prototype.initializeCanvasTarget=function(){try{return this.recomputeDimension(),this.canvasOffscreen=document.createElement("canvas"),this.canvasOffscreen.width=this.offscreenWidth,this.canvasOffscreen.height=this.offscreenHeight,this.drawContextOffscreen=this.canvasOffscreen.getContext("2d"),this.drawContextOnscreen=this.canvas.getContext("2d"),this.initializeCanvasBuffer(),!0}catch(t){return!1}},GfxGlueCode.prototype.initializeCanvasBuffer=function(){this.canvasBuffer=this.getBuffer(this.drawContextOffscreen,this.offscreenWidth,this.offscreenHeight),this.initializeAlpha(this.canvasBuffer.data)},GfxGlueCode.prototype.initializeAlpha=function(t){for(var e=t.length,i=3;i<e;i+=4)t[i]=255},GfxGlueCode.prototype.getBuffer=function(t,e,i){var s=null;try{s=this.drawContextOffscreen.createImageData(e,i)}catch(t){s=this.drawContextOffscreen.getImageData(0,0,e,i)}return s},__VIEWS_SUPPORTED__?GfxGlueCode.prototype.copyBuffer=function(t){if(this.graphicsFound){0==this.swizzledFrameFree.length&&this.swizzledFrameFree.push(this.swizzledFrameReady.shift());var e=this.swizzledFrameFree.shift();e.set(t),this.swizzledFrameReady.push(e)}}:GfxGlueCode.prototype.copyBuffer=function(t){if(this.graphicsFound){0==this.swizzledFrameFree.length&&this.swizzledFrameFree.push(this.swizzledFrameReady.shift());for(var e=this.swizzledFrameFree.shift(),i=0;i<this.offscreenRGBCount;i++)e[i]=t[i];this.swizzledFrameReady.push(e)}},GfxGlueCode.prototype.requestDraw=function(){if(this.swizzledFrameReady.length>0){for(var t=this.canvasBuffer.data,e=this.swizzledFrameReady.shift(),i=0,s=0;i<this.offscreenRGBACount;++i)t[i++]=e[s++],t[i++]=e[s++],t[i++]=e[s++];this.swizzledFrameFree.push(e),this.graphicsBlit(),"function"==typeof this.gfxPostCallback&&this.gfxPostCallback()}},GfxGlueCode.prototype.graphicsBlit=function(){this.canvasLastWidth==this.canvas.clientWidth&&this.canvasLastHeight==this.canvas.clientHeight||(this.recomputeDimension(),this.processSmoothing()),this.offscreenWidth==this.onscreenWidth&&this.offscreenHeight==this.onscreenHeight?this.drawContextOnscreen.putImageData(this.canvasBuffer,0,0):(this.drawContextOffscreen.putImageData(this.canvasBuffer,0,0),this.drawContextOnscreen.drawImage(this.canvasOffscreen,0,0,this.onscreenWidth,this.onscreenHeight))},GfxGlueCode.prototype.setSmoothScaling=function(t){t&&console.warn(" I recognise that the Council decided to enable smooth GBA scaling. But given that it's a stupid decision, I've elected to ignore it."),this.doSmoothing=!1,this.processSmoothing()},GfxGlueCode.prototype.processSmoothing=function(){this.graphicsFound&&(this.canvas.className=this.doSmoothing?"textureSmooth":"texturePixelated",this.drawContextOnscreen.mozImageSmoothingEnabled=this.doSmoothing,this.drawContextOnscreen.webkitImageSmoothingEnabled=this.doSmoothing,this.drawContextOnscreen.imageSmoothingEnabled=this.doSmoothing)};
//# sourceMappingURL=build-index.538079f6.js.map
