"use strict";var injectSaveCode=null;function ImportSaveCallback(e,t,o){try{injectSaveCode&&("FR"==injectSaveCode&&e.includes("TYPE")?setValue("SAVE_"+e,arrayToBase64([FIRE_RED_INIT_SAVE_TYPE])):"FR"==injectSaveCode?setValue("SAVE_"+e,LZUTF8.decompress(FIRE_RED_INIT_SAVE,{inputEncoding:"StorageBinaryString",outputEncoding:"String"})):"C"==injectSaveCode&&e.includes("TYPE")?setValue("SAVE_"+e,arrayToBase64([CRYSTAL_INIT_SAVE_TYPE])):"C"==injectSaveCode?setValue("SAVE_"+e,LZUTF8.decompress(CRYSTAL_INIT_SAVE,{inputEncoding:"StorageBinaryString",outputEncoding:"String"})):"E"==injectSaveCode&&e.includes("TYPE")?setValue("SAVE_"+e,arrayToBase64([EMERALD_INIT_SAVE_TYPE])):"E"==injectSaveCode&&setValue("SAVE_"+e,LZUTF8.decompress(EMERALD_INIT_SAVE,{inputEncoding:"StorageBinaryString",outputEncoding:"String"})));var n=findValue("SAVE_"+e);if(null!=n)return writeRedTemporaryText("Loaded save."),void t(base64ToArray(n))}catch(e){writeRedTemporaryText("Could not read save: "+e.message)}o()}function ExportSave(){IodineGUI.Iodine.exportSave()}function ExportSaveCallback(e,t){if(""!=e)try{setValue("SAVE_"+e,arrayToBase64(t))}catch(e){writeRedTemporaryText("Could not store save: "+e.message)}}function registerSaveHandlers(){IodineGUI.Iodine.attachSaveExportHandler(ExportSaveCallback),IodineGUI.Iodine.attachSaveImportHandler(ImportSaveCallback)}function import_save(e){if((e=decodeBlob(e))&&e.blobs)if(e.blobs.length>0)for(var t=0;t<e.blobs.length;++t){var o=e.blobs[t].blobID,n=e.blobs[t].blobContent;writeRedTemporaryText('Importing blob "'+o+'"'),n?setValue(o,n):o?writeRedTemporaryText('Save file imported had blob "'+o+'" with no blob data interpretable.'):writeRedTemporaryText("Blob chunk information missing completely.")}else writeRedTemporaryText("Could not decode the imported file.");else writeRedTemporaryText("Could not decode the imported file.")}function generateBlob(e,t){var o="EMULATOR_DATA",n="GameBoyAdvance";return o+=to_little_endian_word(o.length+4+(1+n.length)+(1+e.length+(4+t.length))),o+=to_byte(n.length),o+=n,o+=to_byte(e.length),o+=e,o+=to_little_endian_word(t.length),o+=t}function generateMultiBlob(e){var t="GameBoyAdvance",o=18+t.length,n=to_byte(t.length);n+=t;for(var a="",r="",l=0;l<e.length;++l)a=e[l][0],r=e[l][1],n+=to_byte(a.length),n+=a,n+=to_little_endian_word(r.length),n+=r,o+=1+a.length+4+r.length;return n="EMULATOR_DATA"+to_little_endian_word(o)+n}function decodeBlob(e){var t=e.length,o={consoleID:null},n=-1;if(o.blobs=[],t>17&&"EMULATOR_DATA"==e.substring(0,13)){t=Math.min((255&e.charCodeAt(16))<<24|(255&e.charCodeAt(15))<<16|(255&e.charCodeAt(14))<<8|255&e.charCodeAt(13),t);var a=255&e.charCodeAt(17);if(t>17+a){o.consoleID=e.substring(18,18+a);for(var r=0,l=0,i=18+a;i<t;){if(r=255&e.charCodeAt(i++),!(i+r<t)){writeRedTemporaryText("Blob was incomplete, bailing out.");break}if(o.blobs[++n]={},o.blobs[n].blobID=e.substring(i,i+r),!((i+=r)+4<t)){writeRedTemporaryText("Blob was incomplete, bailing out.");break}if(l=(255&e.charCodeAt(i+3))<<24|(255&e.charCodeAt(i+2))<<16|(255&e.charCodeAt(i+1))<<8|255&e.charCodeAt(i),!((i+=4)+l<=t)){writeRedTemporaryText("Blob length check failed, blob determined to be incomplete.");break}o.blobs[n].blobContent=e.substring(i,i+l),i+=l}}}return o}function refreshStorageListing(){for(var e=getSavesKeys(),t=[],o=0;o<e.length;++o)t[o]=[e[o],findValue(e[o])];this.href="data:application/octet-stream;base64,"+base64(generateMultiBlob(t)),this.download="gameboy_advance_saves_"+(new Date).getTime()+".export"}function checkStorageLength(){try{if(window.localStorage)return window.localStorage.length}catch(e){if(window.globalStorage&&location.hostname)return window.globalStorage[location.hostname].length}return 0}function getSavesKeys(){for(var e=checkStorageLength(),t=[],o=0,n=null;o<e&&null!==(n=findKey(o++))&&n.length>0;)"IodineGBA_SAVE_"==n.substring(0,15)&&t.push(n.substring(10));return t}function findKey(e){try{if(window.localStorage)return window.localStorage.key(e)}catch(t){if(window.globalStorage&&location.hostname)return window.globalStorage[location.hostname].key(e)}return null}function to_little_endian_word(e){return to_little_endian_hword(e)+to_little_endian_hword(e>>16)}function to_little_endian_hword(e){return to_byte(e)+to_byte(e>>8)}function to_byte(e){return String.fromCharCode(255&e)}function findValue(e){e="IodineGBA_"+e;try{if(window.localStorage&&null!=window.localStorage.getItem(e))return JSON.parse(window.localStorage.getItem(e))}catch(t){if(window.globalStorage&&location.hostname&&null!=window.globalStorage[location.hostname].getItem(e))return JSON.parse(window.globalStorage[location.hostname].getItem(e))}return null}function setValue(e,t){e="IodineGBA_"+e;try{window.localStorage&&window.localStorage.setItem(e,JSON.stringify(t))}catch(o){window.globalStorage&&location.hostname&&window.globalStorage[location.hostname].setItem(e,JSON.stringify(t))}}function deleteValue(e){e="IodineGBA_"+e;try{window.localStorage&&window.localStorage.removeItem(e)}catch(t){window.globalStorage&&location.hostname&&window.globalStorage[location.hostname].removeItem(e)}}
//# sourceMappingURL=index.38497c03.js.map
