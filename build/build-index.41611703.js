"use strict";function GameBoyAdvanceRTC(t){this.gpio=t,this.pins=0,this.direction=0,this.totalBytes=[0,0,7,0,1,0,3,0],this.bytesRemaining=0,this.transferStep=0,this.reading=0,this.bitsRead=0,this.bits=0,this.command=-1,this.control=64,this.time=[0,0,0,0,0,0,0]}GameBoyAdvanceRTC.prototype.setPins=function(t){switch(this.transferStep){case 0:1==(5&t)&&(this.transferStep=1);break;case 1:4&t&&(this.transferStep=2);break;case 2:1&t?4&t?2&this.direction&&!this.read?(++this.bitsRead,8==this.bitsRead&&this.processByte()):(this.gpio.outputPins(5|this.sioOutputPin()<<1),++this.bitsRead,8==this.bitsRead&&(--this.bytesRemaining,this.bytesRemaining<=0&&(this.command=-1),this.bitsRead=0)):(this.bitsRead=0,this.bytesRemaining=0,this.command=-1,this.transferStep=0):(this.bits&=~(1<<this.bitsRead),this.bits|=(2&t)>>1<<this.bitsRead)}this.pins=7&t},GameBoyAdvanceRTC.prototype.setDirection=function(t){this.direction=t},GameBoyAdvanceRTC.prototype.processByte=function(){switch(--this.bytesRemaining,this.command){case-1:if(6==(15&this.bits))switch(this.command=this.bits>>4&7,this.reading=128&this.bits,this.bytesRemaining=this.totalBytes[this.command],this.command){case 0:this.control=0;break;case 2:case 6:this.updateClock()}else console.WARN("Invalid RTC command byte: "+this.bits.toString(16));break;case 4:this.control=64&this.bits}this.bits=0,this.bitsRead=0,this.bytesRemaining||(this.command=-1)},GameBoyAdvanceRTC.prototype.sioOutputPin=function(){let t=0;switch(this.command){case 4:t=this.control;break;case 2:case 6:t=this.time[7-this.bytesRemaining]}return t>>this.bitsRead&1},GameBoyAdvanceRTC.prototype.updateClock=function(){let t=this.getDate();this.time[0]=this.bcd(t.getFullYear()),this.time[1]=this.bcd(t.getMonth()+1),this.time[2]=this.bcd(t.getDate()),this.time[3]=t.getDay()-1,this.time[3]<0&&(this.time[3]=6),64&this.control?this.time[4]=this.bcd(t.getHours()):(this.time[4]=this.bcd(t.getHours()%2),t.getHours()>=12&&(this.time[4]|=128)),this.time[5]=this.bcd(t.getMinutes()),this.time[6]=this.bcd(t.getSeconds())},GameBoyAdvanceRTC.prototype.bcd=function(t){let i=t%10;return i+=(t/=10)%10<<4,i},GameBoyAdvanceRTC.prototype.useSystemTime=function(){return!1},GameBoyAdvanceRTC.prototype.getDate=function(){let t=new Date;return this.useSystemTime()||(t.setMonth(this.getMonth()),t.setHours(this.getHour(),0,0),t.setDate(t.getDate()+(this.getDay()-t.getDay()))),t},GameBoyAdvanceRTC.prototype.getMonth=function(){return 6},GameBoyAdvanceRTC.prototype.getDay=function(){return 2},GameBoyAdvanceRTC.prototype.getHour=function(){return 12};
//# sourceMappingURL=build-index.41611703.js.map
