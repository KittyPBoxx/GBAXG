"use strict";function GameBoyAdvanceIO(t,e,s,i,a,o){this.systemStatus=0,this.cyclesToIterate=0,this.cyclesOveriteratedPreviously=0,this.accumulatedClocks=0,this.graphicsClocks=0,this.timerClocks=0,this.serialClocks=0,this.nextEventClocks=0,this.BIOSFound=!1,this.SKIPBoot=!!t,this.coreExposed=e,this.BIOS=s,this.ROMS=i,this.ROM_CODES=a,this.NEXT_ROM=o,this.memory=new GameBoyAdvanceMemory(this),this.dma=new GameBoyAdvanceDMA(this),this.dmaChannel0=new GameBoyAdvanceDMA0(this),this.dmaChannel1=new GameBoyAdvanceDMA1(this),this.dmaChannel2=new GameBoyAdvanceDMA2(this),this.dmaChannel3=new GameBoyAdvanceDMA3(this),this.gfxState=new GameBoyAdvanceGraphics(this),this.gfxRenderer=new GameBoyAdvanceRendererProxy(this),this.sound=new GameBoyAdvanceSound(this),this.timer=new GameBoyAdvanceTimer(this),this.irq=new GameBoyAdvanceIRQ(this),this.serial=new GameBoyAdvanceSerial(this),this.joypad=new GameBoyAdvanceJoyPad(this),this.cartridge=new GameBoyAdvanceMultiCartridge(this),this.saves=new GameBoyAdvanceSaves(this),this.wait=new GameBoyAdvanceWait(this),this.cpu=new GameBoyAdvanceCPU(this)}GameBoyAdvanceIO.prototype.initialize=function(t){var e=1;return 1==(0|this.memory.initialize())?(this.dma.initialize(),this.dmaChannel0.initialize(),this.dmaChannel1.initialize(),this.dmaChannel2.initialize(),this.dmaChannel3.initialize(),this.gfxState.initialize(),this.gfxRenderer.initialize(),this.sound.initialize(),this.timer.initialize(),this.irq.initialize(),this.serial.initialize(),this.joypad.initialize(),this.cartridge.initialize(t),this.saves.initialize(),this.wait.initialize(),this.cpu.initialize()):e=0,0|e},GameBoyAdvanceIO.prototype.assignInstructionCoreReferences=function(t,e){this.ARM=t,this.THUMB=e},GameBoyAdvanceIO.prototype.enter=function(t){this.cyclesToIterate=(0|t)+(0|this.cyclesOveriteratedPreviously)|0,(0|this.cyclesToIterate)>0&&(this.updateCoreEventTime(),this.run(),this.updateCoreClocking(),this.sound.audioJIT()),this.cyclesOveriteratedPreviously=0|this.cyclesToIterate},GameBoyAdvanceIO.prototype.run=function(){for(;;)switch(132&this.systemStatus){case 0:this.runARM();break;case 4:this.runTHUMB();break;default:return void this.deflagIterationEnd()}},GameBoyAdvanceIO.prototype.runARM=function(){for(;;)switch(0|this.systemStatus){case 0:this.ARM.executeIteration();break;case 1:case 2:this.ARM.executeBubble(),this.tickBubble();break;default:switch(this.systemStatus>>2){case 2:this.handleIRQARM();break;case 4:case 6:case 12:case 14:this.handleDMA();break;case 8:case 10:this.handleHalt();break;default:if(0!=(132&this.systemStatus))return;this.handleStop()}}},GameBoyAdvanceIO.prototype.runTHUMB=function(){for(;;)switch(0|this.systemStatus){case 4:this.THUMB.executeIteration();break;case 5:case 6:this.THUMB.executeBubble(),this.tickBubble();break;default:switch(this.systemStatus>>2){case 3:this.handleIRQThumb();break;case 5:case 7:case 13:case 15:this.handleDMA();break;case 9:case 17:this.handleHalt();break;default:if(4!=(132&this.systemStatus))return;this.handleStop()}}},GameBoyAdvanceIO.prototype.updateCore=function(t){t|=0,this.accumulatedClocks=(0|this.accumulatedClocks)+(0|t)|0,(0|this.accumulatedClocks)>=(0|this.nextEventClocks)&&this.updateCoreSpill()},GameBoyAdvanceIO.prototype.updateCoreForce=function(t){t|=0,this.accumulatedClocks=(0|this.accumulatedClocks)+(0|t)|0,this.updateCoreSpill()},GameBoyAdvanceIO.prototype.updateCoreNegative=function(t){t|=0,this.accumulatedClocks=(0|this.accumulatedClocks)-(0|t)|0,(0|this.accumulatedClocks)>=(0|this.nextEventClocks)&&this.updateCoreSpill()},GameBoyAdvanceIO.prototype.updateCoreSingle=function(){this.accumulatedClocks=1+(0|this.accumulatedClocks)|0,(0|this.accumulatedClocks)>=(0|this.nextEventClocks)&&this.updateCoreSpill()},GameBoyAdvanceIO.prototype.updateCoreSpill=function(){this.updateCoreClocking(),this.updateCoreEventTime()},GameBoyAdvanceIO.prototype.updateCoreSpillRetain=function(){this.nextEventClocks=(0|this.nextEventClocks)-(0|this.accumulatedClocks)|0,this.updateCoreClocking()},GameBoyAdvanceIO.prototype.updateCoreClocking=function(){var t=0|this.accumulatedClocks;this.cyclesToIterate=(0|this.cyclesToIterate)-(0|t)|0,this.gfxState.addClocks((0|t)-(0|this.graphicsClocks)|0),this.timer.addClocks((0|t)-(0|this.timerClocks)|0),this.serial.addClocks((0|t)-(0|this.serialClocks)|0),this.accumulatedClocks=0,this.graphicsClocks=0,this.timerClocks=0,this.serialClocks=0},GameBoyAdvanceIO.prototype.updateGraphicsClocking=function(){this.gfxState.addClocks((0|this.accumulatedClocks)-(0|this.graphicsClocks)|0),this.graphicsClocks=0|this.accumulatedClocks},GameBoyAdvanceIO.prototype.updateTimerClocking=function(){this.timer.addClocks((0|this.accumulatedClocks)-(0|this.timerClocks)|0),this.timerClocks=0|this.accumulatedClocks},GameBoyAdvanceIO.prototype.updateSerialClocking=function(){this.serial.addClocks((0|this.accumulatedClocks)-(0|this.serialClocks)|0),this.serialClocks=0|this.accumulatedClocks},GameBoyAdvanceIO.prototype.updateCoreEventTime=function(){this.nextEventClocks=0|this.cyclesUntilNextEvent()},GameBoyAdvanceIO.prototype.getRemainingCycles=function(){return(0|this.cyclesToIterate)<1?(this.flagIterationEnd(),0):0|this.cyclesToIterate},GameBoyAdvanceIO.prototype.handleIRQARM=function(){(0|this.systemStatus)>8?(this.ARM.executeBubble(),this.tickBubble()):this.cpu.IRQinARM()},GameBoyAdvanceIO.prototype.handleIRQThumb=function(){(0|this.systemStatus)>12?(this.THUMB.executeBubble(),this.tickBubble()):this.cpu.IRQinTHUMB()},GameBoyAdvanceIO.prototype.handleDMA=function(){do{this.dma.perform()}while(16==(144&this.systemStatus))},GameBoyAdvanceIO.prototype.handleHalt=function(){0==(0|this.irq.IRQMatch())?this.updateCoreForce(0|this.cyclesUntilNextHALTEvent()):this.deflagHalt()},GameBoyAdvanceIO.prototype.handleStop=function(){this.sound.addClocks(0|this.getRemainingCycles()),this.cyclesToIterate=0},GameBoyAdvanceIO.prototype.cyclesUntilNextHALTEvent=function(){var t=0|this.irq.nextEventTime(),e=0|this.dma.nextEventTime();return 0|this.solveClosestTime(0|t,0|e)},GameBoyAdvanceIO.prototype.cyclesUntilNextEvent=function(){var t=0|this.irq.nextIRQEventTime(),e=0|this.dma.nextEventTime();return 0|this.solveClosestTime(0|t,0|e)},GameBoyAdvanceIO.prototype.solveClosestTime=function(t,e){t|=0,e|=0;var s=0|this.getRemainingCycles();return 0|(s=Math.min(0|s,0|t,0|e))},GameBoyAdvanceIO.prototype.flagBubble=function(){this.systemStatus=2|this.systemStatus},GameBoyAdvanceIO.prototype.tickBubble=function(){this.systemStatus=(0|this.systemStatus)-1|0},GameBoyAdvanceIO.prototype.flagTHUMB=function(){this.systemStatus=4|this.systemStatus},GameBoyAdvanceIO.prototype.deflagTHUMB=function(){this.systemStatus=251&this.systemStatus},GameBoyAdvanceIO.prototype.flagIRQ=function(){this.systemStatus=8|this.systemStatus},GameBoyAdvanceIO.prototype.deflagIRQ=function(){this.systemStatus=247&this.systemStatus},GameBoyAdvanceIO.prototype.flagDMA=function(){this.systemStatus=16|this.systemStatus},GameBoyAdvanceIO.prototype.deflagDMA=function(){this.systemStatus=239&this.systemStatus},GameBoyAdvanceIO.prototype.flagHalt=function(){this.systemStatus=32|this.systemStatus},GameBoyAdvanceIO.prototype.deflagHalt=function(){this.systemStatus=223&this.systemStatus},GameBoyAdvanceIO.prototype.flagStop=function(){this.systemStatus=64|this.systemStatus},GameBoyAdvanceIO.prototype.deflagStop=function(){this.systemStatus=191&this.systemStatus},GameBoyAdvanceIO.prototype.flagIterationEnd=function(){this.systemStatus=128|this.systemStatus},GameBoyAdvanceIO.prototype.deflagIterationEnd=function(){this.systemStatus=127&this.systemStatus},GameBoyAdvanceIO.prototype.isStopped=function(){return 0!=(64&this.systemStatus)},GameBoyAdvanceIO.prototype.inDMA=function(){return 0!=(16&this.systemStatus)},GameBoyAdvanceIO.prototype.getCurrentFetchValue=function(){return 0|(0==(16&this.systemStatus)?0|this.cpu.getCurrentFetchValue():0|this.dma.getCurrentFetchValue())};
//# sourceMappingURL=index.d55ec6ec.js.map
