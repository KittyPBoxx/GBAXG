"use strict";function GameBoyAdvanceFLASHChip(t,s){this.largestSizePossible=t?131072:65536,this.notATMEL=!s,this.saves=null,this.BANKOffset=0,this.flashCommandUnlockStage=0,this.flashCommand=0,this.writeBytesLeft=0}GameBoyAdvanceFLASHChip.prototype.initialize=function(){this.allocate()},GameBoyAdvanceFLASHChip.prototype.allocate=function(){if(null==this.saves||(0|this.saves.length)<(0|this.largestSizePossible)){for(var t=getUint8Array(0|this.largestSizePossible),s=0;(0|s)<(0|this.largestSizePossible);s=1+(0|s)|0)t[0|s]=255;if(null!=this.saves)for(s=0;(0|s)<(0|this.saves.length);s=1+(0|s)|0)t[0|s]=0|this.saves[0|s];this.saves=t}},GameBoyAdvanceFLASHChip.prototype.load=function(t){65536!=(0|t.length)&&131072!=(0|t.length)||(this.saves=t,131072==(0|t.length)&&(this.notATMEL=!0))},GameBoyAdvanceFLASHChip.prototype.read=function(t){t|=0;return 0|(2!=(0|this.flashCommand)||(0|t)>1?0|this.saves[t|this.BANKOffset]:0==(0|t)?this.notATMEL?131072==(0|this.largestSizePossible)?98:191:31:this.notATMEL?131072==(0|this.largestSizePossible)?19:212:61)},GameBoyAdvanceFLASHChip.prototype.write=function(t,s){switch(t|=0,s|=0,0|this.writeBytesLeft){case 0:this.writeControlBits(0|t,0|s);break;case 128:for(var e=65408&t|this.BANKOffset,a=0;(0|a)<128;a=1+(0|a)|0)this.saves[e|a]=255;default:this.writeByte(0|t,0|s)}},GameBoyAdvanceFLASHChip.prototype.writeControlBits=function(t,s){switch(s|=0,0|(t|=0)){case 0:this.sectorEraseOrBankSwitch(0|t,0|s);break;case 21845:this.controlWriteStage2(0|s);break;case 10922:this.controlWriteStageIncrement(0|s);break;default:this.sectorErase(0|t,0|s)}},GameBoyAdvanceFLASHChip.prototype.writeByte=function(t,s){t|=0,s|=0,this.saves[t|this.BANKOffset]=0|s,this.writeBytesLeft=(0|this.writeBytesLeft)-1|0},GameBoyAdvanceFLASHChip.prototype.selectBank=function(t){t|=0,this.BANKOffset=(1&t)<<16,this.largestSizePossible=0|Math.max(65536+(0|this.BANKOffset)|0,0|this.largestSizePossible),this.notATMEL=!0,this.allocate()},GameBoyAdvanceFLASHChip.prototype.controlWriteStage2=function(t){if(170==(0|(t|=0)))this.flashCommandUnlockStage=1;else if(2==(0|this.flashCommandUnlockStage)){switch(0|t){case 16:if(1==(0|this.flashCommand))for(var s=0;(0|s)<(0|this.largestSizePossible);s=1+(0|s)|0)this.saves[0|s]=255;this.flashCommand=0;break;case 128:this.flashCommand=1;break;case 144:this.flashCommand=2;break;case 160:this.writeCommandTrigger();break;case 176:this.flashCommand=3;break;default:this.flashCommand=0}this.flashCommandUnlockStage=0}else 240==(0|t)&&(this.flashCommand=0,this.flashCommandUnlockStage=0,this.notATMEL=!0)},GameBoyAdvanceFLASHChip.prototype.writeCommandTrigger=function(){2==(0|this.flashCommandUnlockStage)&&(this.notATMEL?this.writeBytesLeft=1:this.writeBytesLeft=128)},GameBoyAdvanceFLASHChip.prototype.sectorErase=function(t,s){if(t=t<<12>>12,s|=0,1==(0|this.flashCommand)&&2==(0|this.flashCommandUnlockStage)&&48==(0|s)){for(var e=4096+(t|this.BANKOffset)|0,a=t|this.BANKOffset;(0|a)<(0|e);a=1+(0|a)|0)this.saves[0|a]=255;this.notATMEL=!0}this.flashCommand=0,this.flashCommandUnlockStage=0},GameBoyAdvanceFLASHChip.prototype.sectorEraseOrBankSwitch=function(t,s){t|=0,s|=0,2==(0|this.flashCommandUnlockStage)?this.sectorErase(0|t,0|s):3==(0|this.flashCommand)&&0==(0|this.flashCommandUnlockStage)&&this.selectBank(1&s),this.flashCommand=0,this.flashCommandUnlockStage=0},GameBoyAdvanceFLASHChip.prototype.controlWriteStageIncrement=function(t){85==(0|t)&&1==(0|this.flashCommandUnlockStage)?this.flashCommandUnlockStage=1+(0|this.flashCommandUnlockStage)|0:this.flashCommandUnlockStage=0};
//# sourceMappingURL=index.05851f95.js.map
