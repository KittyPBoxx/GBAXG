{"mappings":"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","sources":["dist/Randomiser/Randomisation.js"],"sourcesContent":["var mixedGameData = {};\nObject.entries(FIRE_RED_WARPS).forEach(e => mixedGameData[e[0]] = e[1]);\nObject.entries(CRYSTAL_WARPS).forEach(e => mixedGameData[e[0]] = e[1]);\nObject.entries(EMERALD_WARPS).forEach(e => mixedGameData[e[0]] = e[1]);\n\nvar remappingsData = {};\nvar isHeadless = true;\n\n// WarpList used by EmulationCoreHacks.js\nvar warpList = new Map();\n\nfunction getMapData() {\n    return mixedGameData;\n}\n\nfunction getRandomisationAlgorithm() {\n    return generateRandomMappings;\n}\n\nfunction getRandomisationConfig() {\n    let config = {};\n    config.kantoLevel = document.getElementById(\"kantoLevel\").value;\n    config.johtoLevel = document.getElementById(\"johtoLevel\").value;\n    config.hoennLevel = document.getElementById(\"hoennLevel\").value;\n    return config;\n}\n\nfunction getFlagData() {\n  return FLAG_DATA;\n}\n\nfunction mappingToWarps(mappingData) {\n    let mappedList = new Map();\n\n    mappingData.forEach(mapping => {\n        let from = mapping.trigger;\n        let to = mapping.target;\n        let toParts = to.split(\",\");\n        mappedList.set(from, new PKWarp(from, toParts[0], toParts[1], toParts[2], toParts[3], mapping.source));\n    });\n\n    return mappedList;\n}\n\nasync function mapWarps(seed) {\n\n    flagsState = {};\n    unaddedConditionalEdges = {};\n\n    let config = getRandomisationConfig();\n    let mapData = getFilteredData();\n    let flagData = getFlagData()\n    remappingsData = getRandomisationAlgorithm().apply(null, [seed, mapData, flagData, config]);\n    warpList = mappingToWarps(getAugmetedRemappingData(remappingsData));\n    updateHashDisplay();\n\n    if (typeof storageManager !== 'undefined') {\n      storageManager.persist(\"RANDOM_MAPPING\", new WarpListData(seed, config, warpList));\n    }\n}\n\nfunction generateRandomMappings(seed, mapData, flagData, config) {\n    \n    let rng = new RNG(getHash(seed));\n    let progressionState = initMappingGraph(mapData, isHeadless, new ProgressionState(flagData, config))\n\n    var root = getInitialWarp(config);\n\n    progressionState.unconnectedComponents = progressionState.unconnectedComponents.filter(a => !a.includes(root));\n\n    var moreWarpsToMap = true;\n    while(moreWarpsToMap) {\n        moreWarpsToMap = doNextMapping(rng, root, progressionState);\n        progressionState = updateProgressionState(progressionState, root);\n    }\n\n   return getBaseRemappingData();\n}\n\nfunction getInitialWarp(config) {\n  if (config.kantoLevel > 0) {\n    return KEY_LOCATION_DATA[\"VIRIDIAN CITY\"];\n  }\n  if (config.johtoLevel > 0) {\n    return KEY_LOCATION_DATA[\"NEW BARK TOWN\"];\n  }\n  if (config.hoennLevel > 0) {\n    return KEY_LOCATION_DATA[\"LITTLEROOT TOWN\"];\n  }\n  return KEY_LOCATION_DATA[\"VIRIDIAN CITY\"];\n}\n\nfunction filterIgnored(mapData) {\n    return new Map([...mapData].filter(k => !k[1].ignore));\n}\n\nfunction filterByConfig(usabledWarps, config) {\n    usabledWarps = new Map([...usabledWarps].filter(w => {\n        let filterLevel = null;\n        if (w[0][0] == \"E\") {\n            filterLevel = config.hoennLevel;\n        } else if (w[0][0] == \"F\") {\n            filterLevel = config.kantoLevel;\n        } else if (w[0][0] == \"C\") {\n            filterLevel = config.johtoLevel;\n        }\n\n        return usabledWarps.get(w[0]).level && (+usabledWarps.get(w[0]).level <= +filterLevel);\n    }));\n    return usabledWarps;\n}\n\nfunction filteGroupedNotMain(mapData) {\n    return new Map([...mapData].filter(k => k[1].groupMain || !k[1].grouped));\n} \n\nfunction toMapBank(s) { \n    let arr = s.split(\",\"); \n    return arr[0] + \",\" + arr[1] + \",\" + arr[2] \n}\n\nfunction ProgressionState(flagData, config) {\n  this.remainingConditionalEdges = new Set();\n  this.flags = new Set();\n  this.flagData = flagData;\n  this.config = config;\n  // Locations that may grant further progress\n  this.unmarkedLocations = new Map(Object.entries(flagData.LOCATIONS_TRIGGER));\n  this.unmarkedFlags = new Map(Object.entries(flagData.COMPOSITE_FLAGS));\n  // Locations that will not grant progress but should be included anyway\n  this.unmarkedKeyLocations = new Map(Object.entries(flagData.KEY_LOCATIONS))\n}\n\nProgressionState.prototype.makeFinalLocationsKey = function (config) {\n\n  let finalLocations = [];\n\n  switch(this.config.kantoLevel) {\n    case \"1\": finalLocations.push(HINTABLE_LOCATIONS[\"BROCK\"])   ; break;\n    case \"2\": finalLocations.push(HINTABLE_LOCATIONS[\"MISTY\"])   ; break;\n    case \"3\": finalLocations.push(HINTABLE_LOCATIONS[\"LT SURGE\"]); break; \n    case \"4\": finalLocations.push(HINTABLE_LOCATIONS[\"ERIKA\"])   ; break;\n    case \"5\": finalLocations.push(HINTABLE_LOCATIONS[\"KOGA\"])    ; break;\n    case \"6\": finalLocations.push(HINTABLE_LOCATIONS[\"SABRIBA\"]) ; break;\n    case \"7\": finalLocations.push(HINTABLE_LOCATIONS[\"BLAINE\"])  ; break;\n    case \"8\": finalLocations.push(HINTABLE_LOCATIONS[\"GIOVANNI\"]); break;\n    case \"9\": \n    case \"0\": \n    case \"10\":\n    default: \n      // E4 and upwards are key locations not progression anyway  \n      break;\n  }\n\n  switch(this.config.johtoLevel) {\n    case \"1\": finalLocations.push(HINTABLE_LOCATIONS[\"FALKNER\"]); break;\n    case \"2\": finalLocations.push(HINTABLE_LOCATIONS[\"BUGSY\"])  ; break;\n    case \"3\": finalLocations.push(HINTABLE_LOCATIONS[\"WHITNEY\"]); break; \n    case \"4\": finalLocations.push(HINTABLE_LOCATIONS[\"MORTY\"])  ; break;\n    case \"5\": finalLocations.push(HINTABLE_LOCATIONS[\"CHUCK\"])  ; break;\n    case \"6\": finalLocations.push(HINTABLE_LOCATIONS[\"JASMINE\"]); break;\n    case \"7\": finalLocations.push(HINTABLE_LOCATIONS[\"PRYCE\"])  ; break;\n    case \"8\": finalLocations.push(HINTABLE_LOCATIONS[\"CLAIR\"])  ; break;\n    case \"9\": \n    case \"0\": \n    case \"10\": \n    default:\n      // E4 and upwards are key locations not progression anyway  \n      break;\n  }\n\n  switch(this.config.hoennLevel) {\n    case \"1\": finalLocations.push(HINTABLE_LOCATIONS[\"ROXANNE\"])      ; break;\n    case \"2\": finalLocations.push(HINTABLE_LOCATIONS[\"BRAWLY\"])       ; break;\n    case \"3\": finalLocations.push(HINTABLE_LOCATIONS[\"WATTSON\"])      ; break; \n    case \"4\": finalLocations.push(HINTABLE_LOCATIONS[\"FLANNERY\"])     ; break;\n    case \"5\": finalLocations.push(HINTABLE_LOCATIONS[\"NORMAN\"])       ; break;\n    case \"6\": finalLocations.push(HINTABLE_LOCATIONS[\"WINONA\"])       ; break;\n    case \"7\": finalLocations.push(HINTABLE_LOCATIONS[\"TATE AND LIZA\"]); break;\n    case \"8\": finalLocations.push(HINTABLE_LOCATIONS[\"JAUN\"])         ; break;\n    case \"9\": \n    case \"0\": \n    case \"10\": \n    default:\n      // E4 and upwards are key locations not progression anyway  \n      break;\n  }\n\n  finalLocations.forEach(l => {\n    if (this.unmarkedLocations.has(l)) {\n      this.unmarkedKeyLocations.set(l, this.unmarkedLocations.get(l))\n      this.unmarkedLocations.delete(l);\n    }\n  })\n\n}\n\n/** \n *  Warp data model\n */\nfunction WarpListData(seed, config, warpList) {\n  this.warpList = Array.from(warpList.entries());\n  this.seed = seed;\n  this.config = config;\n} \n\nfunction exportMapping() {\n  storageManager.find(\"RANDOM_MAPPING\").then(s => {\n      let data = JSON.stringify(s);\n      let file = new File([data], \"WarpMapping.json\", {type: \"application/json;charset=utf-8\"});\n      saveAs(file);\n  });\n}\n\nfunction importMapping() {\n  let file = this.files[0];\n\n  let reader = new FileReader();\n  reader.readAsText(file,'UTF-8');\n\n  reader.onload = readerEvent => {\n      let content = readerEvent.target.result;\n      let warpListData = JSON.parse(content);\n      updateWarpListData(warpListData);\n      storageManager.persist(\"RANDOM_MAPPING\", warpListData);\n   }\n}\n\nfunction updateWarpListData(warpListData) {\n  document.getElementById(\"input_seed_text\").value = warpListData.seed;\n\n  document.getElementById(\"kantoLevel\").value = warpListData.config.kantoLevel;\n  document.getElementById(\"johtoLevel\").value = warpListData.config.johtoLevel || warpListData.config.jhotoLevel;\n  document.getElementById(\"hoennLevel\").value = warpListData.config.hoennLevel;\n  M.FormSelect.getInstance(document.getElementById(\"kantoLevel\"))._handleSelectChangeBound();\n  M.FormSelect.getInstance(document.getElementById(\"johtoLevel\"))._handleSelectChangeBound();\n  M.FormSelect.getInstance(document.getElementById(\"hoennLevel\"))._handleSelectChangeBound();\n\n  warpList = new Map(warpListData.warpList);\n  updateHashDisplay();\n}\n\nfunction updateHashDisplay() {\n  document.getElementById(\"hashText\").innerHTML = \"CHECK: \" + Math.abs(getHash(JSON.stringify(Array.from(warpList)))).toString(16).toUpperCase();\n}\n\n/**\n *  Warp Script model \n */\n function PKWarp(trigger, romCode, bank, map, warpNo, source) {\n    this.trigger = trigger;\n    this.toRomCode = romCode;\n    this.toBank = bank;\n    this.toMap = map;\n    this.toWarpNo = warpNo;\n    this.source = source;\n}\n\n/**\n *  SEEDED RNG MANAGEMENT\n */\n\nfunction getHash(input){\n    var hash = 0, len = input.length;\n    for (var i = 0; i < len; i++) {\n      hash  = ((hash << 5) - hash) + input.charCodeAt(i);\n      hash |= 0; // to 32bit integer\n    }\n    return hash;\n}\n\nfunction RNG(seed) {\n    // LCG using GCC's constants\n    this.m = 0x80000000; // 2**31;\n    this.a = 1103515245;\n    this.c = 12345;\n  \n    this.state = seed ? seed : Math.floor(Math.random() * (this.m - 1));\n}\nRNG.prototype.nextInt = function() {\n  this.state = (this.a * this.state + this.c) % this.m;\n  return this.state;\n}\nRNG.prototype.nextFloat = function() {\n  // returns in range [0,1]\n  return this.nextInt() / (this.m - 1);\n}\nRNG.prototype.nextRange = function(start, end) {\n  // returns in range [start, end): including start, excluding end\n  // can't modulu nextInt because of weak randomness in lower bits\n  var rangeSize = end - start;\n  var randomUnder1 = this.nextInt() / this.m;\n  return Math.abs(start + Math.floor(randomUnder1 * rangeSize));\n}\nRNG.prototype.choice = function(array) {\n  return array[this.nextRange(0, array.length)];\n}\n\n/**\n *  GRAPHING / CONNECTION MANAGEMENT\n */\n\n function ReigonNode(id) {\n    this.data = {};\n    this.data.id = id;\n    this.classes = 'reigon';\n}\n\nfunction AreaNode(node) {\n    this.data = {};\n    this.data.id = toMapBank(node[0]);\n    this.data.parent = toReigon(node[0]);\n    this.data.label = node[0] + \" (\" + node[1].name.split(\"-\")[0] + \"- \" + node[1].name.split(\"-\")[1].trim() + \")\";\n}\n\nfunction WarpNode(data) {\n    this.data = {};\n    this.data.id = data[0];\n    this.data.parent = toMapBank(data[0]);\n    this.data.label = data[1].name ? data[0] + data[1].name.split(\"-\")[2] : data[0] + \" (Unnamed)\";\n    this.classes = 'outline';\n    this.data.isWarp = true;\n    this.data.isMapped = false;\n    this.data.hasMultipleConnections = data[1].connections ? Object.values(data[1].connections).filter(n => n == true).length > 0 : false;\n}\n\nfunction FixedEdge(source, target) {\n    this.data = {};\n    this.data.id = source + \"->\" + target;\n    this.data.source = source;\n    this.data.target = target;\n    this.classes = 'fixed';\n}\n\nfunction CondidtionalEdge(source, target, condition) {\n  this.data = {};\n  this.data.id = source + \"->\" + target;\n  this.data.source = source;\n  this.data.target = target;\n  this.classes = 'conditional';\n  this.condition = condition;\n}\n\nfunction WarpEdge(source, target, count) {\n  this.data = {};\n  this.data.id = source + \"->\" + target + \"#\" + window.cy.getElementById(source + \"->\" + target).length;\n  this.data.source = source;\n  this.data.target = target;\n  this.data.isWarp = true;\n  this.classes = 'warp';\n}\n\nfunction getAugmetedRemappingData(remappingData) {\n\n  remappingData = addGroupedMappings(remappingData);\n  remappingData = addTriggerData(remappingData);\n\n  return remappingData;\n}\n\nfunction addGroupedMappings(remappingData) {\n  \n  let groupMappings = [];\n\n  remappingData.forEach(m => {\n    let groups = getMapData()[m.source].grouped;\n    if (groups) {\n      groups.forEach(g => {\n        groupMappings.push({source: g, target: m.target});\n      });\n    }\n  })\n\n  return [...remappingData, ...groupMappings];\n}\n\nfunction addTriggerData(remappingData) {\n\n  return remappingData.map(m => {\n    m.trigger = getMapData()[m.source].to;\n    return m;\n  });\n\n}\n\nfunction getBaseRemappingData() {\n  return cy.edges().filter(e => e.data().isWarp).map(e => { return {source: e.data().source, target: e.data().target} });\n}\n\nfunction getFilteredData() {\n    let warpIdData = new Map(Object.entries(getMapData()));\n    warpIdData = filterIgnored(warpIdData);\n    warpIdData = filteGroupedNotMain(warpIdData);\n    warpIdData = filterByConfig(warpIdData, getRandomisationConfig());\n    return warpIdData;\n}\n\nfunction toReigon(id) {\n    switch(id[0]) {\n        case 'F': return 'KANTO'\n        case 'C': return 'JOHTO'\n        case 'E': return 'HOENN'\n    }\n}\n\nfunction findAccessibleUnmappedNodes(cy, root) {\n  let nodeSet = new Set();\n  cy.elements().bfs({roots: cy.getElementById(root), directed: true, visit: (v, e, u, i, depth) => {\n    \n    if(!v.data().isMapped) {\n      nodeSet.add(v)\n    }\n\n  }});\n  return nodeSet;\n}\n\nfunction doNextMapping(rng, root, progressionState) {\n    let accessibleNodes = progressionState.cachedNodes ? progressionState.cachedNodes : findAccessibleUnmappedNodes(window.cy, root);\n    let inacessibleNodes = cy.nodes().not(accessibleNodes).filter(e => e.data().isWarp && !e.data().isMapped);\n    let inaccesibleFlagLocations = inacessibleNodes.filter(n => progressionState.unmarkedLocations.has(n.data().id));\n    let inaccesibleKeyLocations = inacessibleNodes.filter(n => progressionState.unmarkedLocations.has(n.data().id));\n\n    if(accessibleNodes.size == 0 && inacessibleNodes.length == 0) { \n      return false; \n    }\n\n    let warp1 = [...accessibleNodes][rng.nextRange(0, accessibleNodes.size - 1)];\n    accessibleNodes.delete(warp1);\n    \n    let warp2 = null;\n    let shouldCacheNodes = false;\n    let inacessibleHubs = inacessibleNodes.filter(e => e.degree(true) > 0);\n    if (progressionState.unconnectedComponents.length > 0) {\n\n      // Add a node from every component of the graph (with the assumption no warps are present but all flags are met)\n      let randomComponent = progressionState.unconnectedComponents[rng.nextRange(0, progressionState.unconnectedComponents.length - 1)];\n      let randomNodeIdFromComponent = randomComponent[rng.nextRange(0, randomComponent.length - 1)];\n\n      warp2 = cy.getElementById(randomNodeIdFromComponent);\n      progressionState.unconnectedComponents = progressionState.unconnectedComponents.filter(c => c != randomComponent);\n\n    } else if (inaccesibleFlagLocations.length > 0) { \n\n      // Add inacessible dead-ends that might allow flags givinb access to new locations\n      warp2 = inaccesibleFlagLocations[rng.nextRange(0, inaccesibleFlagLocations.length - 1)];\n\n    } else if (inacessibleHubs.length > 0) {\n\n      // Add any hubs that there is still no access to... I'm not sure there would even be any left...\n      inacessibleNodes = inacessibleNodes.filter(e => e.degree(true) > 0);\n      warp2 = inacessibleNodes[rng.nextRange(0, inacessibleNodes.length - 1)];\n\n    } else if (inaccesibleKeyLocations.length > 0) {\n\n      // Add key inacessible locations \n      warp2 = inaccesibleKeyLocations[rng.nextRange(0, inaccesibleKeyLocations.length - 1)];\n      shouldCacheNodes = true;\n      accessibleNodes.delete(warp2);\n    } else if (inacessibleNodes.length > 0) {\n\n      // Add other inacessible dead-ends \n      warp2 = inacessibleNodes[rng.nextRange(0, inacessibleNodes.length - 1)];\n      shouldCacheNodes = true;\n      accessibleNodes.delete(warp2);\n\n    } else if (accessibleNodes.size > 0) {\n\n      // map together nodes that are already accessible\n      warp2 = [...accessibleNodes][rng.nextRange(0, accessibleNodes.size - 1)];\n      shouldCacheNodes = true;\n      accessibleNodes.delete(warp2);\n\n    } else {\n      //console.warn(\"Unevenly matched warps. \" + warp1.data().id + \" had to map to itself\");\n      // warp2 = warp1\n\n      // if one warp is left hanging we connect it to altering cave from fire red\n      warp2 = cy.add(new WarpNode(['FR,1,122,0', getMapData()[\"FR,1,122,0\"]]));\n      shouldCacheNodes = true;\n      accessibleNodes.delete(warp2);\n\n    }\n\n    // Once it's only dead ends left we can cache which nodes are accessible from the root \n    if (shouldCacheNodes && !progressionState.cachedNodes) {\n        progressionState.cachedNodes = accessibleNodes;\n    }\n\n    if (!warp1) {\n      \n      if (accessibleNodes.size != 0) {\n        console.log(\"Some accessible nodes were left:\")\n        accessibleNodes.forEach(n => {\n          console.log(n.data().id)\n        })\n      } else {\n        console.log(\"All accesible nodes mapped\")\n      }\n\n      if (inacessibleNodes.size != 0) {\n        console.log(\"Some inaccessible nodes were left:\")\n        inacessibleNodes.forEach(n => {\n          console.log(n.data().id)\n        })\n\n        warp2.data().isMapped = true;\n        return false;\n\n      } else {\n        console.log(\"All inaccesible nodes mapped\")\n      }\n\n    }\n\n    window.cy.add(new WarpEdge(warp1.data().id, warp2.data().id))\n\n    if (warp1 != warp2) {\n          window.cy.add(new WarpEdge(warp2.data().id, warp1.data().id))\n    }\n    \n    warp1.data().isMapped = true;\n    warp2.data().isMapped = true;\n\n    return true;\n}\n\n\nfunction updateProgressionState(updateProgressionState, root) {\n\n  let currentNodes = new Set();\n  cy.elements().bfs({roots: cy.getElementById(root), directed: true, visit: (v, e, u, i, depth) => { \n    currentNodes.add(v.data().id) \n  }});\n\n  updateProgressionState.unmarkedLocations.forEach((name, location) => {\n    if (currentNodes.has(location)) {\n      updateProgressionState.unmarkedLocations.delete(location);\n      updateProgressionState.flags.add(name);\n    }\n  });\n\n  updateProgressionState.unmarkedFlags.forEach(n => {\n    if (n.condition.every(flag => updateProgressionState.flags.has(flag))) {\n      updateProgressionState.flags.add(n.flag);\n      updateProgressionState.unmarkedFlags.delete(n.flag)\n    }\n  });\n\n  let conditionalEdges = updateProgressionState.remainingConditionalEdges;\n  conditionalEdges.forEach(e => {\n    if (updateProgressionState.flags.has(e.condition)) {\n      if (cy.getElementById(e.data.target).length > 0 && cy.getElementById(e.data.source).length > 0) {\n        cy.add(e);\n      }\n      conditionalEdges.delete(e);\n    }\n  });\n\n  return updateProgressionState;\n}\n\nfunction initMappingGraph(mapData, isHeadless, progressionState) {\n\n  var cy = window.cy = cytoscape({\n      container: isHeadless ? null : document.getElementById('cy'),\n      headless: isHeadless,\n      styleEnabled: !isHeadless,\n      boxSelectionEnabled: false,\n      textureOnViewport: true,\n    \n      style: [\n        {\n          selector: 'node',\n          css: {\n            'content': 'data(id)',\n            'text-valign': 'center',\n            'text-halign': 'center'\n          }\n        },\n        {\n          selector: ':parent',\n          css: {\n            'text-valign': 'top',\n            'text-halign': 'center'      \n          },\n          style: {\n            'shape' : 'roundrectangle',\n          }\n        },\n        {\n          selector: 'edge',\n          css: {\n            'curve-style': 'bezier',\n            'target-arrow-shape': 'triangle'\n          }\n        },\n        {\n          'selector': 'node[label]',\n          'style': {\n            'label': 'data(label)',\n            'text-valign': 'bottom',\n            'text-halign': 'center'\n          }\n        },\n        {\n          selector: '.reigon',\n          css: {\n              'background-color': '#2f3138',\n              'color' : '#C0C0C0',\n              'font-size' : '5em',\n              \"text-valign\": \"top\"\n          },\n        },\n        {\n          selector: '.map-F',\n          css: {\n              'background-color': '#ffc0c3',\n              'color' : '#C0C0C0',\n              'font-size' : '2em'\n          }\n        },\n        {\n          selector: '.map-C',\n          css: {\n              'background-color': '#c0c3ff',\n              'color' : '#C0C0C0',\n              'font-size' : '2em'\n          }\n        },\n        {\n          selector: '.map-E',\n          css: {\n              'background-color': '#c3ffc0',\n              'color' : '#C0C0C0',\n              'font-size' : '2em'\n          }\n        },\n        {\n          selector: '.warp',\n          css: {\n            'line-color': '#f92411',\n            \"curve-style\": \"straight-triangle\",\n          }\n        },\n        {\n          selector: '.conditional',\n          css: {\n            'line-color': '#1911f9'\n          }\n        },\n        {\n          selector: '.fixed',\n          css: {\n            'opacity': '0.5'\n          }\n        }\n      ],\n    \n      elements: {\n        nodes: [],\n        edges: []\n      }\n    });\n\n\n    cy.add(new ReigonNode(\"KANTO\"));\n    cy.add(new ReigonNode(\"JOHTO\"));\n    cy.add(new ReigonNode(\"HOENN\"));\n\n    let data = [...mapData];\n\n    // Add the nodes\n    data.forEach(d => {\n\n      if (!cy.getElementById(toMapBank(d[0])).length) {\n          cy.add(new AreaNode(d)).addClass(\"map-\" + d[0][0]);\n      }\n\n      cy.add(new WarpNode(d));\n    })\n\n    // Add fixed edges\n    data.forEach(d => {\n\n      let connections = d[1].connections ? d[1].connections : {};\n\n      Object.entries(connections).forEach(entry => {\n\n        if (typeof entry[1] == 'string') {\n\n          // Conditional Connection\n          progressionState.remainingConditionalEdges.add(new CondidtionalEdge(d[0], entry[0], entry[1]));\n\n          // Temporarily add conditional edges in the graph so we can work out what areas will be connected in future\n          if (cy.getElementById(entry[0]).length > 0) {\n            cy.add(new CondidtionalEdge(d[0], entry[0], entry[1]))\n          }\n\n        } else {\n\n          // Fixed Connection       \n\n          // Only draw path if connection node is present in total list of warps\n          // i.e if I'm only doing warps to first gym, don't draw a connection to a gym 2 level warp \n          if (cy.getElementById(entry[0]).length > 0) {\n            cy.add(new FixedEdge(d[0], entry[0]))\n          }\n        }\n      });\n    });\n\n    // calculate future connected areas then remove all conditional edges from the network\n    progressionState.unconnectedComponents = cy.elements().components()\n                                                          .filter(e => e.size() > 1)\n                                                          .map(e => e.toArray().filter(n => n.group() == \"nodes\" && n.data().isWarp && n.data().hasMultipleConnections).map(p => p.data().id))\n                                                          .filter(arr => arr.length > 0);\n    progressionState.remainingConditionalEdges.forEach(node => cy.getElementById(node.data.id).remove());\n\n    cy.nodes().forEach(function(node){\n      node.css(\"width\", 80);\n      node.css(\"height\", 80);\n    });\n\n    if (!isHeadless) {\n        cy.layout({name: 'cose-bilkent', animationDuration: 1000, nodeDimensionsIncludeLabels: true}).run();\n    }\n\n    progressionState.makeFinalLocationsKey();\n    return progressionState;\n}\n\n/* HINTS */\nfunction getHint(location) {\n  let mapData = new Map(Object.entries(getMapData()));\n  let warp = warpList.get(mapData.get(location).to);\n  if (!warp) {\n    return \"NOT PRESENT\";\n  }\n  let info = mapData.get(warp.toRomCode + \",\" + warp.toBank + \",\" + warp.toMap + \",\" + warp.toWarpNo).name;\n  let hint = warp.toRomCode == \"E\" ? \"HOENN - \" : (warp.toRomCode == \"C\" ? \"JOHTO - \" : \"KANTO - \");\n  return hint + info.split(\"-\")[0].trim() + \" - \" + info.split(\"-\")[1].trim();\n}\n\nvar HINTABLE_LOCATIONS = {\n  \"BROCK\"               : \"FR,6,2,1\"  ,\n  \"MISTY\"               : \"FR,7,5,1\"  ,\n  \"LT SURGE\"            : \"FR,9,6,1\"  ,\n  \"ERIKA\"               : \"FR,10,16,1\",\n  \"KOGA\"                : \"FR,11,3,1\" ,\n  \"SABRINA\"             : \"FR,14,3,1\" ,\n  \"BLAINE\"              : \"FR,12,0,1\" ,\n  \"GIOVANNI\"            : \"FR,5,1,1\"  ,\n  \"E4 LORELEI\"          : \"FR,1,75,0\" ,\n  \"E4 BRUNO (FR)\"       : \"FR,1,76,0\" ,\n  \"E4 AGATHA\"           : \"FR,1,77,0\" ,\n  \"E4 LANCE\"            : \"FR,1,78,0\" ,\n  \"CHAMPION RIVAL\"      : \"FR,1,79,0\" ,\n\n  \"FALKNER\"            : \"C,8,1,0\" ,\n  \"BUGSY\"              : \"C,3,3,0\" ,\n  \"WHITNEY\"            : \"C,11,3,0\",\n  \"MORTY\"              : \"C,12,1,0\",\n  \"CHUCK\"              : \"C,4,1,0\" ,\n  \"JASMINE\"            : \"C,10,0,0\",\n  \"PRYCE\"              : \"C,14,0,0\",\n  \"CLAIR\"              : \"C,15,0,0\",\n  \"E4 WILL\"            : \"C,16,0,0\",\n  \"E4 KOGA\"            : \"C,16,1,0\",\n  \"E4 BRUNO (C)\"       : \"C,16,2,0\",\n  \"E4 KAREN\"           : \"C,16,3,0\",\n  \"CHAMPION LANCE\"     : \"C,16,4,0\", \n\n  \"ROXANNE\"          : \"E,11,3,0\"  ,\n  \"BRAWLY\"           : \"E,3,3,0\"   ,\n  \"WATTSON\"          : \"E,10,0,0\"  ,\n  \"FLANNERY\"         : \"E,4,1,0\"   ,\n  \"NORMAN\"           : \"E,8,1,0\"   ,\n  \"WINONA\"           : \"E,12,1,0\"  ,\n  \"TATE AND LIZA\"    : \"E,14,0,0\"  ,\n  \"JAUN\"             : \"E,15,0,0\"  , \n  \"E4 SIDNEY\"        : \"E,16,0,0\"  ,\n  \"E4 PHOEBE\"        : \"E,16,1,0\"  ,\n  \"E4 GLACIA\"        : \"E,16,2,0\"  ,\n  \"E4 DRAKE\"         : \"E,16,3,0\"  ,\n  \"CHAMPION WALLACE\" : \"E,16,4,0\"  ,\n  \"STEVEN\"           : \"E,24,107,0\",\n}\n"],"names":["mixedGameData","Object","entries","FIRE_RED_WARPS","forEach","e","CRYSTAL_WARPS","EMERALD_WARPS","remappingsData","isHeadless","warpList","Map","getMapData","getRandomisationAlgorithm","generateRandomMappings","getRandomisationConfig","config","kantoLevel","document","getElementById","value","johtoLevel","hoennLevel","getFlagData","FLAG_DATA","mappingToWarps","mappingData","mappedList","mapping","from","trigger","toParts","target","split","set","PKWarp","source","async","mapWarps","seed","flagsState","unaddedConditionalEdges","mapData","getFilteredData","flagData","apply","getAugmetedRemappingData","updateHashDisplay","storageManager","persist","WarpListData","rng","RNG","getHash","progressionState","initMappingGraph","ProgressionState","root","getInitialWarp","unconnectedComponents","filter","a","includes","moreWarpsToMap","doNextMapping","updateProgressionState","getBaseRemappingData","KEY_LOCATION_DATA","filterIgnored","k","ignore","filterByConfig","usabledWarps","w","filterLevel","get","level","filteGroupedNotMain","groupMain","grouped","toMapBank","s","arr","this","remainingConditionalEdges","Set","flags","unmarkedLocations","LOCATIONS_TRIGGER","unmarkedFlags","COMPOSITE_FLAGS","unmarkedKeyLocations","KEY_LOCATIONS","Array","exportMapping","find","then","data","JSON","stringify","file","File","type","saveAs","importMapping","files","reader","FileReader","readAsText","onload","readerEvent","content","result","warpListData","parse","updateWarpListData","jhotoLevel","M","FormSelect","getInstance","_handleSelectChangeBound","innerHTML","Math","abs","toString","toUpperCase","romCode","bank","map","warpNo","toRomCode","toBank","toMap","toWarpNo","input","hash","len","length","i","charCodeAt","m","c","state","floor","random","ReigonNode","id","classes","AreaNode","node","parent","toReigon","label","name","trim","WarpNode","isWarp","isMapped","hasMultipleConnections","connections","values","n","FixedEdge","CondidtionalEdge","condition","WarpEdge","count","window","cy","remappingData","addTriggerData","addGroupedMappings","groupMappings","groups","g","push","to","edges","warpIdData","findAccessibleUnmappedNodes","cy1","nodeSet","elements","bfs","roots","directed","visit","v","u","depth","add","accessibleNodes","cachedNodes","inacessibleNodes","nodes","not","inaccesibleFlagLocations","has","inaccesibleKeyLocations","size","warp1","nextRange","delete","warp2","shouldCacheNodes","inacessibleHubs","degree","randomComponent","randomNodeIdFromComponent","console","log","currentNodes","location","every","flag","conditionalEdges","cytoscape","container","headless","styleEnabled","boxSelectionEnabled","textureOnViewport","style","selector","css","shape","color","opacity","d","addClass","entry","components","toArray","group","p","remove","layout","animationDuration","nodeDimensionsIncludeLabels","run","makeFinalLocationsKey","getHint","warp","info","prototype","finalLocations","HINTABLE_LOCATIONS","l","nextInt","nextFloat","start","end","rangeSize","randomUnder1","choice","array","BROCK","MISTY","ERIKA","KOGA","SABRINA","BLAINE","GIOVANNI","FALKNER","BUGSY","WHITNEY","MORTY","CHUCK","JASMINE","PRYCE","CLAIR","ROXANNE","BRAWLY","WATTSON","FLANNERY","NORMAN","WINONA","JAUN","STEVEN"],"version":3,"file":"index.a6389b0e.js.map"}