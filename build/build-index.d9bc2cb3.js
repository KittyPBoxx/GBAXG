"use strict";function GameBoyAdvanceGraphics(t){this.IOCore=t}GameBoyAdvanceGraphics.prototype.initialize=function(){this.gfxRenderer=this.IOCore.gfxRenderer,this.dma=this.IOCore.dma,this.dmaChannel3=this.IOCore.dmaChannel3,this.irq=this.IOCore.irq,this.wait=this.IOCore.wait,this.initializeState()},GameBoyAdvanceGraphics.prototype.initializeState=function(){this.renderedScanLine=!1,this.statusFlags=0,this.IRQFlags=0,this.VCounter=0,this.currentScanLine=0,this.LCDTicks=0,this.IOCore.SKIPBoot&&(this.currentScanLine=124)},GameBoyAdvanceGraphics.prototype.addClocks=function(t){t|=0,this.LCDTicks=(0|this.LCDTicks)+(0|t)|0,this.clockLCDState()},GameBoyAdvanceGraphics.prototype.clockLCDState=function(){(0|this.LCDTicks)>=960&&(this.clockScanLine(),this.clockLCDStatePostRender())},GameBoyAdvanceGraphics.prototype.clockScanLine=function(){this.renderedScanLine||(this.renderedScanLine=!0,(0|this.currentScanLine)<160&&this.gfxRenderer.incrementScanLineQueue())},GameBoyAdvanceGraphics.prototype.clockLCDStatePostRender=function(){(0|this.LCDTicks)>=1006&&(this.updateHBlank(),(0|this.LCDTicks)>=1232&&this.clockLCDNextLine())},GameBoyAdvanceGraphics.prototype.clockLCDNextLine=function(){if(this.renderedScanLine=!1,this.statusFlags=5&this.statusFlags,this.LCDTicks=(0|this.LCDTicks)-1232|0,this.currentScanLine=1+(0|this.currentScanLine)|0,(0|this.currentScanLine)>=160)switch(0|this.currentScanLine){case 160:this.updateVBlankStart();case 161:this.dmaChannel3.gfxDisplaySyncRequest();break;case 162:this.dmaChannel3.gfxDisplaySyncEnableCheck();break;case 227:this.statusFlags=6&this.statusFlags;break;case 228:this.currentScanLine=0}else(0|this.currentScanLine)>1&&this.dmaChannel3.gfxDisplaySyncRequest();this.checkVCounter(),this.isRenderingCheckPreprocess(),this.clockLCDState()},GameBoyAdvanceGraphics.prototype.updateHBlank=function(){0==(2&this.statusFlags)&&(this.statusFlags=2|this.statusFlags,0!=(16&this.IRQFlags)&&this.irq.requestIRQ(2),(0|this.currentScanLine)<160&&this.dma.gfxHBlankRequest(),this.isRenderingCheckPreprocess())},GameBoyAdvanceGraphics.prototype.checkVCounter=function(){(0|this.currentScanLine)==(0|this.VCounter)?(this.statusFlags=4|this.statusFlags,0!=(32&this.IRQFlags)&&this.irq.requestIRQ(4)):this.statusFlags=3&this.statusFlags},GameBoyAdvanceGraphics.prototype.nextVBlankIRQEventTime=function(){var t=2147483647;return 0!=(8&this.IRQFlags)&&(t=0|this.nextVBlankEventTime()),0|t},GameBoyAdvanceGraphics.prototype.nextHBlankEventTime=function(){var t=0|this.LCDTicks;return 0|(t=(0|t)<1006?1006-(0|t)|0:2238-(0|t)|0)},GameBoyAdvanceGraphics.prototype.nextHBlankIRQEventTime=function(){var t=2147483647;return 0!=(16&this.IRQFlags)&&(t=0|this.nextHBlankEventTime()),0|t},GameBoyAdvanceGraphics.prototype.nextVCounterIRQEventTime=function(){var t=2147483647;return 0!=(32&this.IRQFlags)&&(t=0|this.nextVCounterEventTime()),0|t},GameBoyAdvanceGraphics.prototype.nextVBlankEventTime=function(){var t=0|this.currentScanLine;return t=(0|t)<160?160-(0|t)|0:388-(0|t)|0,0|(t=(0|(t=0|this.convertScanlineToClocks(0|t)))-(0|this.LCDTicks)|0)},GameBoyAdvanceGraphics.prototype.nextHBlankDMAEventTime=function(){var t=0|this.nextHBlankEventTime();if((0|this.currentScanLine)>159||159==(0|this.currentScanLine)&&(0|this.LCDTicks)>=1006){var e=227-(0|this.currentScanLine)|0;t=(0|t)+(0|(e=0|this.convertScanlineToClocks(0|e)))|0}return 0|t},GameBoyAdvanceGraphics.prototype.nextVCounterEventTime=function(){var t=2147483647;return(0|this.VCounter)<=227&&((0|(t=(0|this.VCounter)-(0|this.currentScanLine)|0))<=0&&(t=228+(0|t)|0),t=(0|(t=0|this.convertScanlineToClocks(0|t)))-(0|this.LCDTicks)|0),0|t},GameBoyAdvanceGraphics.prototype.nextDisplaySyncEventTime=function(t){t|=0;var e=2147483647;return(0|this.currentScanLine)>=161||0!=(0|t)?(e=230-(0|this.currentScanLine)|0,e=(0|(e=0|this.convertScanlineToClocks(0|e)))-(0|this.LCDTicks)|0):e=0==(0|this.currentScanLine)?2464-(0|this.LCDTicks)|0:1232-(0|this.LCDTicks)|0,0|e},"function"==typeof Math.imul?GameBoyAdvanceGraphics.prototype.convertScanlineToClocks=function(t){return t|=0,0|(t=0|Math.imul(0|t,1232))}:GameBoyAdvanceGraphics.prototype.convertScanlineToClocks=function(t){return 0|(t=1232*(0|(t|=0))|0)},GameBoyAdvanceGraphics.prototype.updateVBlankStart=function(){this.statusFlags=1|this.statusFlags,0!=(8&this.IRQFlags)&&this.irq.requestIRQ(1),this.gfxRenderer.ensureFraming(),this.dma.gfxVBlankRequest()},GameBoyAdvanceGraphics.prototype.isRenderingCheckPreprocess=function(){var t=0==(128&this.gfxRenderer.IOData8[0])&&0==(1&this.statusFlags),e=t&&0==(2&this.statusFlags)?2:1,i=!t||0!=(2&this.statusFlags)&&0!=(32&this.gfxRenderer.IOData8[0])?1:2;this.wait.updateRenderStatus(0|e,0|i)},GameBoyAdvanceGraphics.prototype.writeDISPSTAT8_0=function(t){t|=0,this.IOCore.updateCoreClocking(),this.IRQFlags=56&t,this.IOCore.updateCoreEventTime()},GameBoyAdvanceGraphics.prototype.writeDISPSTAT8_1=function(t){t|=0,(0|(t&=255))!=(0|this.VCounter)&&(this.IOCore.updateCoreClocking(),this.VCounter=0|t,this.checkVCounter(),this.IOCore.updateCoreEventTime())},GameBoyAdvanceGraphics.prototype.writeDISPSTAT16=function(t){t|=0,this.IOCore.updateCoreClocking(),this.IRQFlags=56&t,(0|(t=t>>8&255))!=(0|this.VCounter)&&(this.VCounter=0|t,this.checkVCounter()),this.IOCore.updateCoreEventTime()},GameBoyAdvanceGraphics.prototype.readDISPSTAT8_0=function(){return this.IOCore.updateGraphicsClocking(),this.statusFlags|this.IRQFlags},GameBoyAdvanceGraphics.prototype.readDISPSTAT8_1=function(){return 0|this.VCounter},GameBoyAdvanceGraphics.prototype.readDISPSTAT8_2=function(){return this.IOCore.updateGraphicsClocking(),0|this.currentScanLine},GameBoyAdvanceGraphics.prototype.readDISPSTAT16_0=function(){return this.IOCore.updateGraphicsClocking(),this.VCounter<<8|this.statusFlags|this.IRQFlags},GameBoyAdvanceGraphics.prototype.readDISPSTAT32=function(){return this.IOCore.updateGraphicsClocking(),this.currentScanLine<<16|this.VCounter<<8|this.statusFlags|this.IRQFlags};
//# sourceMappingURL=build-index.d9bc2cb3.js.map
